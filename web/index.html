<!DOCTYPE html>
<html lang="en" data-repo-slug="openai/Wyrd-Engine" data-repo-branch="main">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Synthetic Calendar Generator</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/vis-timeline@9.5.1/styles/vis-timeline-graph2d.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css"
      integrity="sha512-U4nxsLOT9KfPWnYbxcd/WnIr+ChH9cx/kXzMpF9nf4KhQ4Fs10Idgl7J77foDsw9KyYN53ZDy1Y4wl7zngzMuA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="page-header">
      <h1>Synthetic Calendar Generator</h1>
      <p>
        Generate weekly schedules from configuration JSON and explore the results in
        a familiar calendar interface powered by FullCalendar.
      </p>
    </header>

    <nav class="page-nav" aria-label="Primary">
      <button
        type="button"
        class="page-nav__link is-active"
        data-view-target="calendar"
      >
        Calendar
      </button>
      <button
        type="button"
        class="page-nav__link"
        data-view-target="test-console"
      >
        Test Console
      </button>
    </nav>

    <main class="page-layout view" data-view="calendar">
      <section class="card form-card">
        <h2>Configuration</h2>
        <form id="config-form" novalidate>
          <div class="form-row">
            <label for="start-date">Week starting (optional)</label>
            <input id="start-date" name="start-date" type="date" />
            <p class="help-text">Leave blank to start on the current week&#8217;s Monday.</p>
          </div>
          <div class="form-row">
            <label for="config-input">Configuration JSON</label>
            <textarea
              id="config-input"
              name="config-input"
              spellcheck="false"
              rows="20"
            ></textarea>
            <p class="help-text">
              Provide the same JSON structure used by <code>calendar_gen.py</code>.
            </p>
          </div>
          <div class="form-actions">
            <button type="submit">Generate schedule</button>
          </div>
          <p class="form-error" id="form-error" role="alert"></p>
        </form>
      </section>

      <section class="card hidden results-card" id="results">
        <div class="results-header">
          <div>
            <h2 id="results-title">Generated schedule</h2>
            <p id="results-subtitle"></p>
          </div>
          <button type="button" id="download-json" disabled>Download JSON</button>
        </div>
        <div class="results-body">
          <aside class="summary">
            <h3>Weekly totals</h3>
            <div class="totals" id="totals"></div>
          </aside>
          <div class="calendar-wrapper">
            <div class="calendar-warning hidden" id="calendar-warning">
              FullCalendar failed to load. Check your network connection and reload the page.
            </div>
            <div id="calendar"></div>
          </div>
        </div>
        <section
          class="replay-inspector hidden"
          id="replay-inspector"
          aria-label="Minute picker and JSON inspector"
        >
          <div class="replay-inspector__visual">
            <div class="replay-inspector__header">
              <h3>Minute picker</h3>
              <p class="replay-minute" id="replay-minute-label">
                Hover or tap the wheel to inspect minute ranges.
              </p>
            </div>
            <svg
              class="replay-radial"
              id="replay-radial"
              viewBox="0 0 420 420"
              role="presentation"
            ></svg>
          </div>
          <div class="replay-inspector__data">
            <div class="replay-inspector__header">
              <h3>Event JSON</h3>
              <p class="replay-inspector__hint">
                Click any entry to highlight its arc and scroll into view.
              </p>
            </div>
            <div class="replay-event-list" id="replay-event-list" role="list"></div>
          </div>
        </section>
        <details class="raw-json">
          <summary>Raw JSON output</summary>
          <pre id="json-output"></pre>
        </details>
      </section>
    </main>

    <main class="view view--test-console hidden" data-view="test-console">
      <section class="card test-console-card">
        <div class="test-console-header">
          <div>
            <h2>Test Console</h2>
            <p class="test-console-subtitle">
              Experiment with scripted scenarios using the Wyrd runtime.
            </p>
          </div>
          <div class="test-console-actions">
            <button type="button" id="test-console-load">Load Runtime</button>
            <button type="button" id="test-console-run" disabled>Run</button>
          </div>
        </div>
        <div class="test-console-body">
          <aside class="test-console-sidebar">
            <section class="repo-browser" id="repo-file-panel">
              <div class="repo-browser__header">
                <h3 class="repo-browser__title">Repo files</h3>
                <p class="repo-browser__subtitle">
                  Browse curated project scripts and fixtures hosted on GitHub.
                </p>
              </div>
              <div class="form-row repo-browser__row">
                <label for="repo-file-select">File</label>
                <div class="repo-browser__controls">
                  <select id="repo-file-select" name="repo-file-select"></select>
                  <button type="button" id="repo-file-fetch">Preview</button>
                </div>
              </div>
              <div class="repo-browser__preview" aria-live="polite">
                <pre id="repo-file-preview">Select a file to preview its contents.</pre>
              </div>
              <div class="repo-browser__actions">
                <button type="button" id="repo-file-load" disabled>Load into editor</button>
                <p class="repo-browser__status" id="repo-file-status" role="status"></p>
              </div>
            </section>
            <div class="form-row">
              <span class="form-label">Editor presets</span>
              <div
                class="test-console-presets"
                role="group"
                aria-label="Python editor presets"
              >
                <button
                  type="button"
                  class="preset-button"
                  data-script-preset="mk1_quick"
                >
                  Run MK1 quick test
                </button>
                <button
                  type="button"
                  class="preset-button"
                  data-script-preset="mk2_quick"
                >
                  Run MK2 quick test
                </button>
                <button
                  type="button"
                  class="preset-button"
                  data-script-preset="compare_minimal"
                >
                  Compare MK1 vs MK2 (minimal)
                </button>
                <button
                  type="button"
                  class="preset-button"
                  data-script-preset="scratch"
                >
                  Scratch Pad
                </button>
              </div>
              <p class="help-text">
                Load a ready-to-run script or start with an empty scratch pad.
              </p>
            </div>
            <div class="form-row">
              <label for="test-console-code">Python code</label>
              <textarea
                id="test-console-code"
                name="test-console-code"
                rows="14"
                spellcheck="false"
              ></textarea>
              <p class="help-text">
                The selected script runs inside an isolated Pyodide runtime. Access the
                parsed input via the <code>payload</code> variable.
              </p>
            </div>
            <div class="form-row">
              <label for="test-console-input">Input JSON</label>
              <textarea
                id="test-console-input"
                name="test-console-input"
                rows="12"
                spellcheck="false"
                placeholder='{"events": []}'
              ></textarea>
              <p class="help-text">
                Provide JSON parameters that will be passed to the selected script.
              </p>
            </div>
            <div class="form-row">
              <label for="runner-config-json">Runner config JSON</label>
              <textarea
                id="runner-config-json"
                name="runner-config-json"
                rows="10"
                spellcheck="false"
                placeholder="{\n  \"name\": \"Alice\"\n}"
              ></textarea>
              <p class="help-text">
                Parsed and injected into <code>__runner_input__['config']</code> before execution.
              </p>
            </div>
            <div class="form-row">
              <span class="form-label">Execution parameters</span>
              <div class="runner-inputs">
                <label class="runner-inputs__item" for="runner-seed">
                  <span class="runner-inputs__label">Seed</span>
                  <input
                    id="runner-seed"
                    name="runner-seed"
                    type="number"
                    inputmode="numeric"
                    placeholder="Optional"
                  />
                </label>
                <label class="runner-inputs__item" for="runner-start-date">
                  <span class="runner-inputs__label">Start date</span>
                  <input
                    id="runner-start-date"
                    name="runner-start-date"
                    type="text"
                    inputmode="numeric"
                    placeholder="YYYY-MM-DD"
                  />
                </label>
                <label class="runner-inputs__item" for="runner-days">
                  <span class="runner-inputs__label">Days</span>
                  <input
                    id="runner-days"
                    name="runner-days"
                    type="number"
                    inputmode="numeric"
                    placeholder="Optional"
                    min="1"
                  />
                </label>
              </div>
              <p class="help-text">
                All values are available to scripts via the <code>__runner_input__</code> global.
              </p>
            </div>
          </aside>
          <div class="test-console-outputs">
            <div class="output-panel">
              <div class="output-panel-header">
                <h3>Stdout</h3>
              </div>
              <pre id="test-console-stdout">Waiting for execution…</pre>
            </div>
            <div class="output-panel">
              <div class="output-panel-header">
                <h3>Stderr</h3>
              </div>
              <pre id="test-console-stderr">No errors yet.</pre>
            </div>
            <div class="output-panel">
              <div class="output-panel-header">
                <h3>Result</h3>
              </div>
              <pre id="test-console-result">No output yet.</pre>
            </div>
            <div class="output-panel diff-panel" id="fixture-diff-panel">
              <div class="output-panel-header diff-panel__header">
                <div class="diff-panel__header-text">
                  <h3>Fixture Diff</h3>
                  <p class="diff-panel__subtitle">
                    Compare the latest script output to repository fixtures.
                  </p>
                </div>
                <div class="diff-panel__controls">
                  <label class="diff-panel__select" for="fixture-select">
                    <span>Select expected fixture</span>
                    <select id="fixture-select" name="fixture-select" disabled>
                      <option value="">Loading fixtures…</option>
                    </select>
                  </label>
                  <span class="diff-panel__badge is-pending" id="fixture-diff-badge"
                    >No fixture selected</span
                  >
                </div>
              </div>
              <div class="diff-panel__summary" id="fixture-diff-summary">
                Choose a fixture to compare against the most recent result.
              </div>
              <div class="diff-panel__body">
                <div class="diff-panel__column">
                  <h4 class="diff-panel__column-title">Expected fixture</h4>
                  <pre class="diff-panel__output" id="fixture-expected-output"
                    >Select a fixture to load expected JSON.</pre
                  >
                </div>
                <div class="diff-panel__column">
                  <h4 class="diff-panel__column-title">Actual output</h4>
                  <pre class="diff-panel__output" id="fixture-actual-output"
                    >Run the script to capture JSON output.</pre
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="test-console-status" role="status" aria-live="polite">
          <span
            class="status-indicator is-idle"
            id="test-console-status-indicator"
            aria-hidden="true"
          ></span>
          <span id="test-console-status-text">Runtime not loaded yet.</span>
        </div>
      </section>
    </main>

    <footer class="page-footer">
      <p>
        Built for the Synthetic Calendar Generator MVP. View the
        <a href="../calendar_gen.py">Python implementation</a> for CLI usage.
      </p>
    </footer>

    <template id="event-row-template">
      <div class="event-row">
        <div class="event-time"></div>
        <div class="event-activity"></div>
        <div class="event-duration"></div>
      </div>
    </template>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"
      integrity="sha512-vuKXu95syEHCqB6f+GO6zkRgZNpmjDoE7YQDdyCjTiMQuuLHfoalGexiLRNvKcJsteVEhDWUpAJZciV06P88hg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"
      integrity="sha512-ykBLL8GMDIS9ZhDJW60Trw7O3cu6UytzszbmWzxubUoil58x2oyWZMhUlCT3VkOITkkpFmS6r30YIOCwRvDDcw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="https://unpkg.com/vis-timeline@9.5.1/standalone/umd/vis-timeline-graph2d.min.js"></script>
    <script src="app.js" type="module"></script>
  </body>
</html>
