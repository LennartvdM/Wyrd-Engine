<!DOCTYPE html>
<html lang="en" data-repo-slug="LennartvdM/Wyrd-Engine" data-repo-branch="main">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Synthetic Calendar Generator</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/vis-timeline@9.5.1/styles/vis-timeline-graph2d.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css"
      integrity="sha512-uf06llspW44/LZpHzHT6qBOIVODjWtv4MxCricRxkzvopAlSWnTf6hpZTFxuuZcuNE9CBQhqE0Seu1CoRk84nQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="page-layout view" data-view="calendar" id="calendar-view">
      <section class="card form-card">
        <div class="card-heading">
          <h2>Configuration</h2>
          <div class="view-switcher" role="group" aria-label="Primary views">
            <button
              type="button"
              class="view-tab is-active"
              data-view-target="calendar"
              aria-controls="calendar-view"
              aria-label="Show calendar view"
              data-tooltip="Show the generated calendar"
            >
              Calendar
            </button>
            <button
              type="button"
              class="view-tab"
              data-view-target="test-console"
              aria-controls="test-console-view"
              aria-label="Show test console"
              data-tooltip="Switch to the test console"
            >
              Test Console
            </button>
          </div>
        </div>
        <form id="config-form" novalidate>
          <div class="form-row">
            <label for="start-date">Week starting (optional)</label>
            <input id="start-date" name="start-date" type="date" />
            <p class="help-text">Leave blank to start on the current week&#8217;s Monday.</p>
          </div>
          <div class="form-row">
            <label for="engine-select">Engine version</label>
            <select id="engine-select" name="engine"></select>
            <p class="help-text">
              Choose which engine implementation to run when generating a schedule.
            </p>
          </div>
          <div class="form-row form-row--full" id="config-json-row">
            <label for="config-input">Configuration JSON</label>
            <textarea
              id="config-input"
              name="config-input"
              spellcheck="false"
              rows="12"
              form="config-form"
            ></textarea>
            <p class="help-text">
              Provide the same JSON structure used by <code>calendar_gen.py</code>.
            </p>
          </div>
          <div class="form-actions">
            <button type="submit" id="generate-button">Generate schedule</button>
          </div>
          <p class="form-status" id="form-status" role="status" aria-live="polite"></p>
        </form>
      </section>

      <section class="card mk2-panel hidden" id="mk2-panel">
        <fieldset class="mk2-panel__section" id="mk2-options">
          <legend class="mk2-panel__heading">MK2 options</legend>
          <div class="form-row">
            <label for="mk2-archetype">Archetype</label>
            <select id="mk2-archetype" name="mk2-archetype" form="config-form">
              <option value="office">Office</option>
              <option value="parent">Parent</option>
              <option value="freelancer">Freelancer</option>
            </select>
          </div>
          <div class="form-row">
            <label for="mk2-rig">Rig</label>
            <select id="mk2-rig" name="mk2-rig" form="config-form">
              <option value="calendar">Calendar</option>
              <option value="workforce">Workforce</option>
            </select>
          </div>
          <div class="form-row">
            <div class="form-row__label-group">
              <label for="mk2-seed">Seed</label>
              <button type="button" id="mk2-reset-defaults" class="link-button">Reset defaults</button>
            </div>
            <div class="mk2-seed-controls">
              <input id="mk2-seed" name="mk2-seed" type="number" inputmode="numeric" form="config-form" />
              <label class="checkbox-inline" for="mk2-surprise">
                <input id="mk2-surprise" name="mk2-surprise" type="checkbox" form="config-form" />
                <span>Surprise me</span>
              </label>
            </div>
          </div>
          <div class="form-row">
            <label for="mk2-start">Week start</label>
            <input id="mk2-start" name="mk2-start" type="date" form="config-form" />
          </div>
          <div class="form-row">
            <label for="mk2-budget">Yearly budget (optional)</label>
            <textarea id="mk2-budget" name="mk2-budget" rows="3" spellcheck="false" form="config-form"></textarea>
          </div>
        </fieldset>
        <div class="mk2-panel__section" id="mk2-config-target"></div>
      </section>

      <section class="card hidden results-card" id="results">
        <div class="results-header">
          <div>
            <h2 id="results-title">Generated schedule</h2>
            <p id="results-subtitle"></p>
          </div>
          <div class="results-actions" role="group" aria-label="Export options">
            <button
              type="button"
              class="action-button"
              id="download-json"
              disabled
              aria-label="Download the generated schedule as JSON"
              data-tooltip="Download the generated schedule as JSON"
            >
              Download JSON
            </button>
            <button
              type="button"
              class="action-button action-button--outline"
              id="export-frame-png"
              disabled
              aria-label="Export the current radial frame as a PNG image"
              data-tooltip="Export the current frame as PNG"
            >
              Frame PNG
            </button>
            <button
              type="button"
              class="action-button action-button--outline"
              id="export-frame-svg"
              disabled
              aria-label="Export the current radial frame as an SVG"
              data-tooltip="Download the vector frame as SVG"
            >
              Frame SVG
            </button>
            <button
              type="button"
              class="action-button action-button--warm"
              id="export-replay-gif"
              disabled
              aria-label="Export a five second replay as a GIF"
              data-tooltip="Capture a five second replay as GIF"
            >
              Replay GIF
            </button>
            <button
              type="button"
              class="action-button action-button--compression"
              id="export-replay-mp4"
              disabled
              aria-label="Export a five second replay as MP4"
              data-tooltip="Record a five second replay as MP4"
            >
              Replay MP4
            </button>
          </div>
        </div>
        <p class="export-status" id="export-status" role="status" aria-live="polite"></p>
        <section class="diagnostics-panel hidden" id="diagnostics-panel">
          <details class="diagnostics-details" id="diagnostics-details">
            <summary class="diagnostics-summary" id="diagnostics-summary">
              <span class="diagnostics-summary__label">Diagnostics</span>
              <span class="diagnostics-summary__badge hidden" id="diagnostics-issue-count"></span>
            </summary>
            <div class="diagnostics-content">
              <div class="diagnostics-section hidden" id="diagnostics-issues-section">
                <h3>Issues</h3>
                <ul class="diagnostics-issues" id="diagnostics-issues" role="list"></ul>
              </div>
              <div class="diagnostics-section hidden" id="diagnostics-metadata-section">
                <h3>Metadata</h3>
                <dl class="diagnostics-stats" id="diagnostics-stats"></dl>
                <div class="diagnostics-subsection hidden" id="diagnostics-day-types-section">
                  <h4>Day types</h4>
                  <ul class="diagnostics-day-types" id="diagnostics-day-types" role="list"></ul>
                </div>
                <div class="diagnostics-subsection hidden" id="diagnostics-compression-section">
                  <h4>Compression logs</h4>
                  <div class="diagnostics-compression" id="diagnostics-compression"></div>
                </div>
              </div>
            </div>
          </details>
        </section>
        <div class="results-body">
          <aside class="summary">
            <h3>Weekly totals</h3>
            <div class="totals" id="totals"></div>
          </aside>
          <div class="calendar-wrapper">
            <div class="calendar-warning hidden" id="calendar-warning">
              FullCalendar failed to load. Check your network connection and reload the page.
            </div>
            <div id="calendar"></div>
          </div>
        </div>
        <section
          class="replay-inspector hidden"
          id="replay-inspector"
          aria-label="Minute picker and JSON inspector"
        >
          <div class="replay-inspector__visual">
            <div class="replay-inspector__header">
              <div class="replay-heading">
                <h3>Minute picker</h3>
                <button
                  type="button"
                  class="replay-info-button"
                  id="replay-info-button"
                  aria-expanded="false"
                  aria-controls="replay-info-popover"
                  aria-label="About the MK2 engine"
                >
                  ?
                </button>
                <div
                  class="replay-info-popover hidden"
                  id="replay-info-popover"
                  role="dialog"
                  aria-label="MK2 engine narrative"
                  tabindex="-1"
                >
                  <p>
                    MK2 simulates behavioural drift across the week by layering fatigue and
                    morale on top of baseline routines.
                  </p>
                  <p>
                    It samples friction curves to stretch or compress activities without
                    breaking the 24-hour ledger.
                  </p>
                  <p>
                    Calendar, validation, and unique-event modules plug in as overrides so
                    regional or policy rules can swap freely.
                  </p>
                  <p>
                    Each frame logs diagnostics so operators can audit why minutes moved and
                    who absorbed the slack.
                  </p>
                </div>
              </div>
              <p class="replay-minute" id="replay-minute-label">
                Hover or tap the wheel to inspect minute ranges.
              </p>
            </div>
            <svg
              class="replay-radial"
              id="replay-radial"
              viewBox="0 0 420 420"
              role="presentation"
            ></svg>
            <div class="replay-legend" aria-label="Replay legend">
              <div class="replay-legend__item">
                <span class="replay-legend__term">Friction</span>
                <span class="replay-legend__definition">dents from fatigue/inefficiency</span>
              </div>
              <div class="replay-legend__item">
                <span class="replay-legend__term">Day-type</span>
                <span class="replay-legend__definition">weekend/holiday masks</span>
              </div>
              <div class="replay-legend__item">
                <span class="replay-legend__term">Unique events</span>
                <span class="replay-legend__definition">vacations/sick overrides</span>
              </div>
              <div class="replay-legend__item">
                <span class="replay-legend__term">Compression</span>
                <span class="replay-legend__definition">overflow resolution</span>
              </div>
            </div>
          </div>
          <div class="replay-inspector__data">
            <div class="replay-inspector__header">
              <h3>Event JSON</h3>
              <p class="replay-inspector__hint">
                Click any entry to highlight its arc and scroll into view.
              </p>
            </div>
            <div class="replay-event-list" id="replay-event-list" role="list"></div>
          </div>
        </section>
        <details class="raw-json">
          <summary>Raw JSON output</summary>
          <pre id="json-output"></pre>
        </details>
      </section>
    </main>
    <div id="toast-container" aria-live="polite" aria-atomic="true"></div>

    <main class="view view--test-console hidden" data-view="test-console" id="test-console-view">
      <section class="card test-console-card">
        <div class="test-console-header">
          <div class="test-console-actions">
            <button type="button" id="test-console-load">Load Runtime</button>
            <button type="button" id="test-console-run" disabled>Run</button>
          </div>
          <div class="view-switcher" role="group" aria-label="Primary views">
            <button
              type="button"
              class="view-tab"
              data-view-target="calendar"
              aria-controls="calendar-view"
              aria-label="Show calendar view"
              data-tooltip="Show the generated calendar"
            >
              Calendar
            </button>
            <button
              type="button"
              class="view-tab is-active"
              data-view-target="test-console"
              aria-controls="test-console-view"
              aria-label="Show test console"
              data-tooltip="Switch to the test console"
            >
              Test Console
            </button>
          </div>
        </div>
        <div class="test-console-body">
          <aside class="test-console-sidebar">
            <div class="test-console-tabs" data-tab-group="test-console">
              <div class="test-console-tablist" role="tablist" aria-label="Test console sections">
                <button
                  type="button"
                  class="test-console-tab is-active"
                  id="test-console-tab-resources"
                  role="tab"
                  aria-selected="true"
                  aria-controls="test-console-panel-resources"
                  data-tab-target="resources"
                >
                  Resources
                </button>
                <button
                  type="button"
                  class="test-console-tab"
                  id="test-console-tab-script"
                  role="tab"
                  aria-selected="false"
                  aria-controls="test-console-panel-script"
                  data-tab-target="script"
                >
                  Script
                </button>
                <button
                  type="button"
                  class="test-console-tab"
                  id="test-console-tab-inputs"
                  role="tab"
                  aria-selected="false"
                  aria-controls="test-console-panel-inputs"
                  data-tab-target="inputs"
                >
                  Input &amp; Params
                </button>
              </div>
              <div class="test-console-tabpanels">
                <section
                  id="test-console-panel-resources"
                  class="test-console-panel is-active"
                  role="tabpanel"
                  tabindex="0"
                  aria-labelledby="test-console-tab-resources"
                  data-tab-panel="resources"
                >
                  <section class="repo-browser" id="repo-file-panel">
                    <div class="repo-browser__header">
                      <h3 class="repo-browser__title">Repo files</h3>
                      <p class="repo-browser__subtitle">
                        Browse curated project scripts and fixtures hosted on GitHub.
                      </p>
                    </div>
                    <div class="form-row repo-browser__row">
                      <label for="repo-file-select">File</label>
                      <div class="repo-browser__controls">
                        <select id="repo-file-select" name="repo-file-select"></select>
                        <button type="button" id="repo-file-fetch">Preview</button>
                      </div>
                    </div>
                    <div class="repo-browser__preview" aria-live="polite">
                      <pre id="repo-file-preview">Select a file to preview its contents.</pre>
                    </div>
                    <div class="repo-browser__actions">
                      <button type="button" id="repo-file-load" disabled>Load into editor</button>
                      <p class="repo-browser__status" id="repo-file-status" role="status"></p>
                    </div>
                  </section>
                  <div class="form-row">
                    <span class="form-label">Editor presets</span>
                    <div
                      class="test-console-presets"
                      role="group"
                      aria-label="Python editor presets"
                    >
                      <button
                        type="button"
                        class="preset-button"
                        data-script-preset="mk1_quick"
                      >
                        Run MK1 quick test
                      </button>
                      <button
                        type="button"
                        class="preset-button"
                        data-script-preset="mk2_quick"
                      >
                        Run MK2 quick test
                      </button>
                      <button
                        type="button"
                        class="preset-button"
                        data-script-preset="compare_minimal"
                      >
                        Compare MK1 vs MK2 (minimal)
                      </button>
                      <button
                        type="button"
                        class="preset-button"
                        data-script-preset="scratch"
                      >
                        Scratch Pad
                      </button>
                    </div>
                    <p class="help-text">
                      Load a ready-to-run script or start with an empty scratch pad.
                    </p>
                  </div>
                </section>
                <section
                  id="test-console-panel-script"
                  class="test-console-panel"
                  role="tabpanel"
                  tabindex="0"
                  aria-labelledby="test-console-tab-script"
                  data-tab-panel="script"
                  hidden
                >
                  <div class="form-row">
                    <label for="test-console-code">Python code</label>
                    <textarea
                      id="test-console-code"
                      name="test-console-code"
                      rows="14"
                      spellcheck="false"
                    ></textarea>
                    <p class="help-text">
                      The selected script runs inside an isolated Pyodide runtime. Access the
                      parsed input via the <code>payload</code> variable.
                    </p>
                  </div>
                </section>
                <section
                  id="test-console-panel-inputs"
                  class="test-console-panel"
                  role="tabpanel"
                  tabindex="0"
                  aria-labelledby="test-console-tab-inputs"
                  data-tab-panel="inputs"
                  hidden
                >
                  <div class="form-row">
                    <label for="test-console-input">Input JSON</label>
                    <textarea
                      id="test-console-input"
                      name="test-console-input"
                      rows="12"
                      spellcheck="false"
                      placeholder='{"events": []}'
                    ></textarea>
                    <p class="help-text">
                      Provide JSON parameters that will be passed to the selected script.
                    </p>
                  </div>
                  <div class="form-row">
                    <label for="runner-config-json">Runner config JSON</label>
                    <textarea
                      id="runner-config-json"
                      name="runner-config-json"
                      rows="10"
                      spellcheck="false"
                      placeholder="{\n  \"name\": \"Alice\"\n}"
                    ></textarea>
                    <p class="help-text">
                      Parsed and injected into <code>__runner_input__['config']</code> before execution.
                    </p>
                  </div>
                  <div class="form-row">
                    <span class="form-label">Execution parameters</span>
                    <div class="runner-inputs">
                      <label class="runner-inputs__item" for="runner-seed">
                        <span class="runner-inputs__label">Seed</span>
                        <input
                          id="runner-seed"
                          name="runner-seed"
                          type="number"
                          inputmode="numeric"
                          placeholder="Optional"
                        />
                      </label>
                      <label class="runner-inputs__item" for="runner-start-date">
                        <span class="runner-inputs__label">Start date</span>
                        <input
                          id="runner-start-date"
                          name="runner-start-date"
                          type="text"
                          inputmode="numeric"
                          placeholder="YYYY-MM-DD"
                        />
                      </label>
                      <label class="runner-inputs__item" for="runner-days">
                        <span class="runner-inputs__label">Days</span>
                        <input
                          id="runner-days"
                          name="runner-days"
                          type="number"
                          inputmode="numeric"
                          placeholder="Optional"
                          min="1"
                        />
                      </label>
                    </div>
                    <p class="help-text">
                      All values are available to scripts via the <code>__runner_input__</code> global.
                    </p>
                  </div>
                </section>
              </div>
            </div>
          </aside>
          <div class="test-console-outputs">
            <div class="output-panel">
              <div class="output-panel-header">
                <h3>Stdout</h3>
              </div>
              <pre id="test-console-stdout">Waiting for execution…</pre>
            </div>
            <div class="output-panel">
              <div class="output-panel-header">
                <h3>Stderr</h3>
              </div>
              <pre id="test-console-stderr">No errors yet.</pre>
            </div>
            <div class="output-panel">
              <div class="output-panel-header">
                <h3>Result</h3>
              </div>
              <pre id="test-console-result">No output yet.</pre>
            </div>
            <div class="output-panel diff-panel" id="fixture-diff-panel">
              <div class="output-panel-header diff-panel__header">
                <div class="diff-panel__header-text">
                  <h3>Fixture Diff</h3>
                  <p class="diff-panel__subtitle">
                    Compare the latest script output to repository fixtures.
                  </p>
                </div>
                <div class="diff-panel__controls">
                  <label class="diff-panel__select" for="fixture-select">
                    <span>Select expected fixture</span>
                    <select id="fixture-select" name="fixture-select" disabled>
                      <option value="">Loading fixtures…</option>
                    </select>
                  </label>
                  <span class="diff-panel__badge is-pending" id="fixture-diff-badge"
                    >No fixture selected</span
                  >
                </div>
              </div>
              <div class="diff-panel__summary" id="fixture-diff-summary">
                Choose a fixture to compare against the most recent result.
              </div>
              <div class="diff-panel__body">
                <div class="diff-panel__column">
                  <h4 class="diff-panel__column-title">Expected fixture</h4>
                  <pre class="diff-panel__output" id="fixture-expected-output"
                    >Select a fixture to load expected JSON.</pre
                  >
                </div>
                <div class="diff-panel__column">
                  <h4 class="diff-panel__column-title">Actual output</h4>
                  <pre class="diff-panel__output" id="fixture-actual-output"
                    >Run the script to capture JSON output.</pre
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <template id="event-row-template">
      <div class="event-row">
        <div class="event-time"></div>
        <div class="event-activity"></div>
        <div class="event-duration"></div>
      </div>
    </template>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"
      integrity="sha512-OeZ4Yrb/W7d2W4rAMOO0HQ9Ro/aWLtpW9BUSR2UOWnSV2hprXLkkYnnCGc9NeLUxxE4ZG7zN16UuT1Elqq8Opg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"
      integrity="sha512-Vs2GKxnxnTQBRW7o2xXZ9A28njjmu5RToS42efiKNEWmikov0inZY522EtGVK5CcVo0M/FQwmXsTfl9skgRnvw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="https://unpkg.com/vis-timeline@9.5.1/standalone/umd/vis-timeline-graph2d.min.js"></script>
    <script src="app.js" type="module"></script>
  </body>
</html>
